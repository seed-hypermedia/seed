syntax = "proto3";

package com.seed.documents.v3alpha;

import "documents/v3alpha/documents.proto";
import "documents/v3alpha/comments.proto";
import "p2p/v1alpha/syncing.proto";

option go_package = "seed/backend/genproto/documents/v3alpha;documents";

// Service for querying Hypermedia resources.
//
// Note: This API had to be separate to avoid circular dependencies between documents and comments.
service Resources {
  // Gets a single resource with a URL (technically IRI).
  rpc GetResource(GetResourceRequest) returns (Resource);

  // Makes sure a resource (and their related blobs) are pushed to a given peer.
  rpc PushResourcesToPeer(PushResourcesToPeerRequest) returns (stream com.seed.p2p.v1alpha.AnnounceBlobsProgress);
}

// Request to get a single resource by its IRI.
message GetResourceRequest {
  // Required. IRI of the resource to retrieve.
  string iri = 1;
}

// An identifiable entity, accessible with a unique identifier.
message Resource {
  // Various kinds of resources.
  oneof kind {
    Document document = 1;

    Comment comment = 2;

    Contact contact = 3;
  }

  // Optional. The version of the resource (when applicable).
  string version = 4;
}

message PushResourcesToPeerRequest {
  // A list of multiaddrs for the same peer ID to attempt p2p connection.
  // For example `/ip4/10.0.0.1/tcp/55000/p2p/QmDeadBeef`.
  repeated string addrs = 1;

  // Required. Resource IRIs to push. We will also push
  // related blobs to those resources. No wilcards are supported.
  // Only documents resources can be specified. No single comments supported yet.
  // See https://seedteamtalks.hyper.media/projects/daemon-pushing-algo
  repeated string resources = 2;

  // Optional. Whether to push children documents recursively as well.
  bool recursive = 3;
}
